- name: "Install gptfdisk package"
  pacman:
    name: gptfdisk
    state: present

- name: "Erase disk, including part-table and partitions"
  command: sgdisk --zap-all /dev/{{ disk_format_install_drive|quote }}

- name: "Write new GPT partition table to disk"
  command: sgdisk --mbrtogpt /dev/{{ disk_format_install_drive|quote }}

  - name: "Add BIOS-motherboard GRUB bootloader partition to disk"
  command: sgdisk --new 1:0:{{ gvar_boot_partition_size|quote }}
                  --typecode 1:{{ gvar_gdisk_part_code_bios_boot|quote }}02
                  --change-name 1:{{ gvar_boot_partition_label|quote }}
                  /dev/{{ disk_format_install_drive|quote }}

- name: "Add zfs partition to disk"
  command: sgdisk --new 2:0:0
                  --typecode 2:{{ gvar_gdisk_part_code_solaris_root|quote }}
                  --change-name 2:{{ gvar_zfs_partition_label|quote }}
                  /dev/{{ disk_format_install_drive|quote }}

