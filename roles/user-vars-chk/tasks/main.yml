- name: "Import variables from optional, user-specified file"
  include_vars:
    file: "{{ user_vars_file }}"
  when: user_vars_file is defined
  ignore_errors: true

- name: "Abort if user did not specify user_var_motherboard_type"
  fail:
    msg: "user_var_motherboard_type variable must be specified (see group_vars/all file)"
  when: user_var_motherboard_type != "bios" and user_var_motherboard_type != "uefi"

- name: "Abort if user did not specify user_var_device_1"
  fail:
    msg: "user_var_device_1 variable must be set to 'sdx' (see group_vars/all file)"
  when: user_var_device_1 is not regex("^sd.$")

- name: "Compose '_mirror' string-appends if installing to mirrored disks"
  set_fact:
    mirror0_append: "{{ '_mirror0' if user_var_device_2 is regex('^sd.$') else '' }}"
    mirror1_append: "{{ '_mirror1' if user_var_device_2 is regex('^sd.$') else '' }}"
    device_2_boot_base: "{{ const_var_boot_partlabel_base if user_var_device_2 is regex('^sd.$') else '' }}"
    device_2_zfs_base: "{{ const_var_zfs_partlabel_base if user_var_device_2 is regex('^sd.$') else '' }}"

